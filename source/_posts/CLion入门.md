---
title: CLion入门
date: 2023-1-31
---

# 一. 前言

IDE 一直是我之前不想去用的一个东西，一方面是不想把从源文件到可执行程序的中间过程交给 IDE 去管理，另一方面就是大部分的 IDE 都太臃肿了，而且启动速度还慢。

但当我真正了解了一个 IDE 的工作过程之后，发现它确实要比自己手动操作方便不少。而且在更换了 Linux 开发环境之后我发现在 Linux 中运行 JetBrains 的软件比在 Windows 中快上不少（我是 Ubuntu），所以就花了一天时间学习了一下 CLion 的工作原理，所以在这里记录一下。



# 二. CMake

在打开 CLion 后，我最疑惑的一点就是在我的项目源文件里的一个文件：`CMakeLists.txt`，我根本不知道这是干嘛用的。

先说结论，这是`cmake`的脚本文件，`cmake`是一个工具，它可以执行这样的一个文件。而要知道 CMake 是个什么东西，那就需要先回到全手动的代码编译过程中去：

**手动的代码编译过程**：

- 首先我们准备好所有的源文件
- 然后通过`gcc\g++`命令来编译源文件成最终的可执行文件（其中的预编译、编译、汇编、链接等过程不进行详细考虑，这其中所有的过程暂时统一称为编译）

就是这么简单的两步而已，看起来会觉得 IDE 根本没有用武之地，但是仔细想想第二个过程，如果我们的源文件很多，并且分散在不同的文件夹中，而且有时还需要链接第三方库，那么我们如果是在调试阶段，那每一次修改代码都需要写一长串的`gcc\g++`命令，所以针对这个问题，就有一种解决方案出来了，就是 makefile

**makefile**：

这是一种脚本文件，我们提前在这个文件里写好这个项目需要如何编译，包括一些复杂的命令之类的。然后我们在每一次修改代码之后直接使用`make`工具运行这个`makefile`脚本即可按照预先写好的过程进行编译，那么在调试阶段我们就可以省下很多用于写命令的时间。

有人会发现，好像到这里就可以结束了，我们只需要提前写好一份 makefile 就可以了，还有 IDE 什么事呢？

其实，makefile 有一个缺点，那就是不跨平台。我们的程序可能需要跑在多种系统，多种机器上，但 makefile 不跨平台，也就是说一个 makefile 文件只能编译出一个平台上可用的程序，要想做到生成多个平台的程序，那就需要写多个 makefile，这个工程量人力虽然也是可完成的，但是难免会觉得累，就像把一段只有一两个变量不同的重复代码写了很多遍一样。

解决的方法其实也就在上一段话中，我们可以通过函数来解决重复代码的问题，也就是抽象，而足够抽象的东西是具有高度的复用性的。而 CMake 也就是 makefile 等工具的抽象。

**CMake**：

使用 CMake 首先需要一个`CMakeLists.txt`文件，有了这个文件，我们就可以执行`cmake`命令（和使用`gcc\g++`命令类似），通过使用`cmake`命令，我们就可以得到一个根据`CMakeLists.txt`的内容生成的符合我们当前环境（需要先设置好工具链，在下一节会讲到）的 Makefile 文件（也可能是其他文件如 `build.ninja`，通过 CMake 的配置项决定）。

然后点击构建按钮，IDE 就会使用我们预先配置好的生成器（如 make）来执行这个 Makefile 文件，然后我们就能得到需要的可执行程序了。

点击运行按钮，IDE 就会运行这个可执行程序了。



# 三. CLion

在上一节我们说到了 CMake 的工作原理，很显然，要使用 CMake，我们首先必须要有四样东西：

1. CMake：这个软件一般在安装 IDE 的时候会自动安装，用于生成编译用的脚本
2. 构建工具：如 make、ninja 等，即通过执行编译脚本构建可执行程序的工具，用于构建可执行程序。
3. 编译器：如 gcc、g++ 等，是在构建工具执行编译脚本时所必需的一个工具，否则无法正常生成可执行程序
4. 调试器：如 gdb 等，即代码还在调试阶段时 CMake 生成的脚本会保留调试信息，由于调试是一个程序基本上逃不过的过程，所以调试器也是必要的。

这四种工具在 CLion 中合称“工具链”，如下图所示：

![图片](https://user-images.githubusercontent.com/91216205/215761590-61c03491-5f6a-4398-a323-19e17ece2bee.png)

需要注意的是在工具链的配置中最主要的工具实际上是：编译器、调试器和 CMake 这三项，而生成工具实际上在配置工具链这一步并非主要，之所以需要配置，是要确保你是否有这样的一种工具。同时之所以通过 CMake 能够生成符合我们当前环境的脚本文件就是由于这个工具链，因为在配置工具链时我们要保证每一个工具都存在且能够正常运行。

在配置好工具链后，我们就可以来配置 CMake 了，具体的配置项如下图所示：

![图片](https://user-images.githubusercontent.com/91216205/215763448-232726dc-aa46-426b-b2ee-9c50c326d2f9.png)

其具体的配置项如下：

- 名称：随便起，这只是一个配置文件的名称而已

- 构建类型：最主要的就是`Debug`和`Release`两种，其中`Debug`类型会在构建时保留调试信息，便于调试，而`Release`类型不会保留这类信息，同时其性能比`Debug`要好

- 工具链：即我们上一步配置好的工具链，可以配置多个工具链，然后在这里选择一个即可，默认工具链一般是第一个工具链，主要使用到的是 CMake 、编译器和调试器这三项

- 生成器：也就是在工具链中配置的构建工具，在这里如果选择默认那么就是在上一项所选择的工具链中的构建工具，也可以选择其他的生成器

- CMake 选项：也就是在我们写好`CMakeLists.txt`文件之后执行`cmake`命令时后面所跟的选项，最主要的就是`-G`选项，用于选择生成的脚本的类型，一般在选择好生成器之后会自动填在下面

- 构建目录：生成好的脚本文件就放在这个目录下面

- 构建选项：这是当我们已经生成了脚本文件之后，构建时使用`cmake`命令时的选项，即在这种配置下，点击构建按钮时 IDE 执行的命令应该像下面这样：

  ```bash
  cmake --build ${PROJECT_BINARY_DIR} --target ${PROJECT_NAME} -j 9
  ```

  其中第一个选项是我们上一项配置中所设置好的构建目录，`PROJECT_BINARY_DIR`是在`CMakeLists.txt`文件中定义好的，第二个选项是要生成的可执行文件的名称，`PROJECT_NAME`也是我们在`CMakeLists.txt`中定义好的，然后最后的选项就是我们在构建选项这一框中填写的内容。

  这个命令首先在`PROJECT_BINARY_DIR`这个目录下生成与我们选择的生成器所对应的脚本文件，如 make 对应的就是 makefile，Ninja 对应的就是 build.ninja。然后它会调用我们选择的生成器来执行刚刚生成的脚本文件，最终生成我们需要的可执行文件。

由于 CMake 生成脚本文件的依据就是`CMakeLists.txt`文件和我们选择的生成器，所以基本上决定一个项目如何编译就是靠的`CMakeLists.txt`这个文件，而写这个文件就需要去学习 CMake 的编写方法，这在本文中不会进行介绍。



# 四. 项目结构

在新建一个项目后，我们会看到文件夹里多了一些文件，理解这些文件对我们理解 CLion 的工作原理是有帮助的。

- `.idea`：这个文件夹不算重要，它是用于标识其父文件夹是一个 CLion 项目用的
- `cmake-build-debug`：一般新建项目之后都有这个文件夹，这是因为新建项目都会自动生成一个 CMake 配置文件，这个配置文件选择的构建类型都是`Debug`类型，而且其构建目录的名称也都是`cmake-build-${构建类型}`的格式，所以会有这样一个文件夹。如果我们新建一个 CMake 配置文件并且启用，那么我们只要用`cmake`运行一下`CMakeLists.txt`文件就可以发现又多了一个与其类似的文件夹。`cmake`命令生成的脚本文件以及最后的可执行文件都在这个文件夹下，其中另外一些其他的文件及文件夹并非特别重要。
- `CMakeLists.txt`：这个文件即`cmake`执行的文件，`cmake`会根据其内容生成对应的脚本文件
- 其他文件：主要就是我们的项目的主体了，一般新建项目会自动创建一个`main.c`或者`main.cpp`



# 五. 总结

在本文中，我们主要讲解了 CMake 的工作原理以及 CLion 如何利用 CMake 进行工作，以及 CLion 中工具链的概念。同时具体解释了 CLion 中最重要的两个配置项的配置，即 工具链 和 CMake。

而所有另外的配置都比较简单也都不是 CLion 中需要理解的重要设置，如更换主题，设置代码格式等等。

通过本文，我们应该了解了 CMake 在 CLion 的一个重要地位，我们只需要写好一个`CMakeLists.txt`文件，就可以在不同的平台，方便快捷地构建我们需要的项目。所以实际上使用 CLion 的本质也就是使用 CMake，当然本文只是一个入门，并不讨论 CMake 应该怎么写，学习 CMake 的编写可以去看看官方的文档，也可以去找一找其他人的相应的教程。